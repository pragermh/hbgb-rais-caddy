{
	log {
		level warn
		output stdout
		format console
	}
}
:8080 {
	encode gzip zstd

	# Route A: proxy /iiif/* to RAIS (exclusive)
	@iiif path /iiif/*
	handle @iiif {
		reverse_proxy rais:12415
	}

	# Route B: static + SPA fallback for everything else
	handle {
		root * /srv/www
		try_files {path} /index.html
		file_server
	}

	# Optional: long cache for shard JSON
	@idx path /idx/*
	header @idx Cache-Control "public, max-age=31536000, immutable"
	header @idx Content-Type "application/json; charset=utf-8"
}
